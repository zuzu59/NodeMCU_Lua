<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
  <meta charset='utf-8' name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>SonOff home page</title>
</head>
<body>
    <h1>SonOff home page 200109.1940</h1>
    <h2>Menu:</h2>
    <h3>
    SonOff API LED
    <a href="api_sonoff.html?LED=on"> On</a>
    <a href="api_sonoff.html?LED=off"> Off</a><br>

    SonOff API RELAY
    <a href="api_sonoff.html?RELAY=on"> On</a>
    <a href="api_sonoff.html?RELAY=off"> Off</a><br>
    <br>

    <a href="z_index.html?SetupWIFI=true">Wifi setup (setup_gadget, 192.168.4.1)</a><br>

    <a href="disp_temp.html">Affichage des températures, affiche les températures mesurées</a><br>
    </h3>

<%
            if (vars ~= nil) then
                zout("<br>vars: "..vars.."<br>")
                for k, v in string.gmatch(vars, "(%w+)=(%w+%p+%w+)&*") do
                    _GET[k] = v
                    zout(k..": "..v.."<br>")
                end
            end
            if (_GET.SetupWIFI == "true") then
                --zout("<br><br>Choisir comme WIFI AP: setup_gadget puis aller sur: http://192.168.4.1<br><br>")
                file.putcontents("_setup_wifi_", "toto")
                file.putcontents("_toto_", "toto")
                tmr.create():alarm(3*1000,  tmr.ALARM_SINGLE, function()
                    node.restart()
                end)
            end
            if (_GET.RESTART == "true") then

                zout("oups restart...")

            end
%>

    <br>Etat de la LED:<nsp>
<%
    if gpio.read(zLED) == 1 then zout("OFF") else zout("ON") end
%>

    <br>Etat du RELAY:<nsp>
<%
    zRELAY=6
    if gpio.read(zRELAY) == 0 then zout("OFF") else zout("ON") end
%>

    <br><br>
<%
    a,b,c = wifi.sta.getip()
    if a ~= nil then
        zout("IP: "..a.."&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MASK: "..b.."&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GATEWAY: "..c.."<br>")
    end
    collectgarbage()   zout("RAM: "..node.heap())
%>
</body>
</html>
